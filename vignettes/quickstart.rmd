---
title: "Quick Start with CDER"
author: "Michael Koohafkan"
date: "2020-06-12"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Quick Start}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---




The R package `cder` provides a simple interface to the CDEC
Webservice. Getting CDEC data with `cder` is easy, just pass a 
station code to `cdec_query()`:


```r
# get data for CDEC station NSL
cdec_query("NSL")
#> # A tibble: 578 x 9
#>    StationID Duration SensorNumber SensorType
#>    <chr>     <chr>           <int> <chr>     
#>  1 NSL       E                   1 RIV STG   
#>  2 NSL       E                   1 RIV STG   
#>  3 NSL       E                   1 RIV STG   
#>  4 NSL       E                   1 RIV STG   
#>  5 NSL       E                   1 RIV STG   
#>  6 NSL       E                   1 RIV STG   
#>  7 NSL       E                   1 RIV STG   
#>  8 NSL       E                   1 RIV STG   
#>  9 NSL       E                   1 RIV STG   
#> 10 NSL       E                   1 RIV STG   
#> # ... with 568 more rows, and 5 more variables:
#> #   DateTime <dttm>, ObsDate <dttm>, Value <dbl>,
#> #   DataFlag <chr>, SensorUnits <chr>
```

The CDEC web service uses some default values for the duration code,
sensor number, and start/end dates. However, these default values vary
from station to station, and sometimes a station will return no data by
default. It's generally a good idea to specify these yourself:


```r
station = "NSL"
duration = "event" # or "E"
sensor = 100 # electrical conductivity
start.date = Sys.Date() - 14
end.date = Sys.Date()

cdec_query(station, sensor, duration, start.date, end.date)
#> # A tibble: 1,345 x 9
#>    StationID Duration SensorNumber SensorType
#>    <chr>     <chr>           <int> <chr>     
#>  1 NSL       E                 100 EL COND   
#>  2 NSL       E                 100 EL COND   
#>  3 NSL       E                 100 EL COND   
#>  4 NSL       E                 100 EL COND   
#>  5 NSL       E                 100 EL COND   
#>  6 NSL       E                 100 EL COND   
#>  7 NSL       E                 100 EL COND   
#>  8 NSL       E                 100 EL COND   
#>  9 NSL       E                 100 EL COND   
#> 10 NSL       E                 100 EL COND   
#> # ... with 1,335 more rows, and 5 more variables:
#> #   DateTime <dttm>, ObsDate <dttm>, Value <dbl>,
#> #   DataFlag <chr>, SensorUnits <chr>
```

The web service supports multiple stations, sensors, and even 
duration codes:


```r
# get data for CDEC stations NSL and HUN
stations = c("NSL", "HUN")
# get electrical conductivity and stage
sensors = c(100, 1)
# get event data and hourly averages (where available)
durations = c("event", "hourly")

cdec_query(stations, sensors, durations)
#> # A tibble: 240 x 9
#>    StationID Duration SensorNumber SensorType
#>    <chr>     <chr>           <int> <chr>     
#>  1 HUN       E                   1 RIV STG   
#>  2 HUN       E                   1 RIV STG   
#>  3 HUN       E                   1 RIV STG   
#>  4 HUN       E                   1 RIV STG   
#>  5 HUN       E                   1 RIV STG   
#>  6 HUN       E                   1 RIV STG   
#>  7 HUN       E                   1 RIV STG   
#>  8 HUN       E                   1 RIV STG   
#>  9 HUN       E                   1 RIV STG   
#> 10 HUN       E                   1 RIV STG   
#> # ... with 230 more rows, and 5 more variables:
#> #   DateTime <dttm>, ObsDate <dttm>, Value <dbl>,
#> #   DataFlag <chr>, SensorUnits <chr>
```

That's it! The CDEC Webservice currently does not support querying 
station metadata. To browse station data, use the 
[Station Search tool](https://cdec.water.ca.gov/dynamicapp/staSearch)
or [Locator Map](http://cdec.water.ca.gov/cdecstation2/). These
URLs can also be accessed by calling `cdec_search_stations()` and 
`cdec_map()`, respectively. See `help("cdec-search")` for more 
information.To access the metadata page for a particular station, use
`cdec_meta()`.
